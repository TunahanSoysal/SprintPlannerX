<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Task Details</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
              rel="stylesheet"
              integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
              crossorigin="anonymous">
        <link rel="stylesheet" th:href="@{/css/dashboard.css}">
        <script th:src="@{/js/dashboard.js}"></script>
        <link rel="stylesheet" th:href="@{/css/board.css}">
        <script th:src="@{/js/board.js}"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
                crossorigin="anonymous"></script>

        <!-- jQuery eklemeyi unutmayın -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"
                integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
                crossorigin="anonymous"></script>
        <script>
            function openTaskDetails(button) {
                var taskId = button.dataset.taskId;
                var taskName = button.dataset.taskName;
                var taskStatus = button.dataset.taskStatus;
                var taskDeveloper = button.dataset.taskDeveloper;
                var taskAnalyst = button.dataset.taskAnalyst;
                var taskDueDate = button.dataset.taskDueDate;
                var taskFinalSP = button.dataset.taskFinalSP;
                var taskEvent = button.dataset.taskEvent;
                var taskIsStarred = button.dataset.taskIsStarred;

                // Task nesnesini oluştur
                var task = {
                    id: taskId,
                    name: taskName,
                    status: taskStatus,
                    developer: taskDeveloper,
                    analyst: taskAnalyst,
                    dueDate: taskDueDate,
                    finalSP: taskFinalSP,
                    event: taskEvent,
                    isStarred: taskIsStarred
                };

                // Task detaylarını göster
                showTaskDetails(task);
            }

            function showTaskDetails(task) {
                var taskIdInput = document.getElementById("taskId");
                if (taskIdInput) {
                    taskIdInput.value = task.id;
                }

                var taskNameInput = document.getElementById("taskName");
                if (taskNameInput) {
                    taskNameInput.value = task.name;
                }

                var taskStatusInput = document.getElementById("taskStatus");
                if (taskStatusInput) {
                    taskStatusInput.value = task.status;
                }

                var taskDeveloperInput = document.getElementById("taskDeveloper");
                if (taskDeveloperInput) {
                    taskDeveloperInput.value = task.developer;
                }

                var taskAnalystInput = document.getElementById("taskAnalyst");
                if (taskAnalystInput) {
                    taskAnalystInput.value = task.analyst;
                }

                var taskDueDateInput = document.getElementById("taskDueDate");
                if (taskDueDateInput) {
                    taskDueDateInput.value = task.dueDate;
                }

                var taskFinalSPInput = document.getElementById("taskFinalSP");
                if (taskFinalSPInput) {
                    taskFinalSPInput.value = task.finalSP;
                }

                var taskEventInput = document.getElementById("taskEvent");
                if (taskEventInput) {
                    taskEventInput.value = task.event;
                }

                var taskIsStarredInput = document.getElementById("taskIsStarred");
                if (taskIsStarredInput) {
                    taskIsStarredInput.value = task.isStarred;
                }
            }

            function saveTaskDetails() {
                // Burada formdaki verileri alıp bir HTTP isteği yapabilir ve veriyi güncelleyebilirsiniz.
                // Örnek olarak bir fetch kullanalım:
                var taskId = document.getElementById("taskId").value;
                var taskName = document.getElementById("taskName").value;
                var taskStatus = document.getElementById("taskStatus").value;
                var taskDeveloper = document.getElementById("taskDeveloper").value;
                var taskAnalyst = document.getElementById("taskAnalyst").value;
                var taskDueDate = document.getElementById("taskDueDate").value;
                var taskFinalSP = document.getElementById("taskFinalSP").value;
                var taskEvent = document.getElementById("taskEvent").value;
                var taskIsStarred = document.getElementById("taskIsStarred").value;






                // ... Diğer inputlardan gerekli verileri al ...

                // Örnek bir fetch isteği
                fetch('/tasks/'+taskId, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: taskName,
                        status: taskStatus,
                        developer:taskDeveloper,
                        analyst:taskAnalyst,
                        dueDate:taskDueDate,
                        finalSP:taskFinalSP,
                        // ... Diğer verileri ekleyin ...
                    }),
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log('Success:', data);
                        alert('Task details saved successfully!');
                    })
                    .catch((error) => {
                        console.error('Error:', error);
                        alert('An error occurred while saving task details.');
                    });
            }

        </script>
    </head>
    <body>
        <div class="container mt-5">
            <div class="row">
                <!-- Sol Tarafta Görev Listesi -->
                <div class="col-md-4">
                    <h4>Task List</h4>
                    <ul class="list-group">
                        <li id="taskItem" th:each="task : ${tasks}"
                            class="list-group-item list-group-item-action"
                            onclick="openTaskDetails(this)"
                            th:data-task-id="${task.ID}"
                            th:data-task-name="${task.name}"
                            th:data-task-status="${task.status}"
                            th:data-task-developer="${task.developer.username}"
                            th:data-task-analyst="${task.analyst.username}"
                            th:data-task-due-date="${task.dueDate}"
                            th:data-task-final-sp="${task.finalSP}"
                            th:data-task-event="${task.event.eventName}"
                            th:data-task-is-starred="${task.starred}">
                            <span th:text="${task.name}"></span>
                            <span th:text="${task.ID}"></span>
                            <span class="badge bg-dark" th:if="${task.developer.onTrackedTask == task && task.developer.name == user}">On Track Dev</span>
                            <span class="badge bg-dark" th:if="${task.analyst.onTrackedTask == task && task.analyst.name == user}">On Track Analyst</span>
                        </li>
                    </ul>
                </div>

                <!-- Sağ Tarafta Görev Detayları -->
                <div class="col-md-8">
                    <div id="taskDetailsContainer">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Task Details</h5>
                                <form>
                                    <div class="mb-3">
                                        <label for="taskId" class="form-label">ID</label>
                                        <input type="text" class="form-control" id="taskId" value="" >
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskName" class="form-label">Name</label>
                                        <input type="text" class="form-control" id="taskName" value="" >
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskStatus" class="form-label">Status</label>
                                        <input type="text" class="form-control" id="taskStatus" value="" >
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskDeveloper" class="form-label">Developer</label>
                                        <input type="text" class="form-control" id="taskDeveloper" value="" >
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskAnalyst" class="form-label">Analyst</label>
<!--                                        <input type="text" class="form-control" id="taskAnalyst" value="" >-->
                                        <select class="form-select" id="taskAnalyst" th:field="*{user}">
                                            <option th:each="user: ${allUsers}" th:text="${user.username}" th:value="${user.username}"></option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskDueDate" class="form-label">Due Date</label>
                                        <input type="text" class="form-control" id="taskDueDate" value="" >
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskFinalSP" class="form-label">Final SP</label>
                                        <input type="text" class="form-control" id="taskFinalSP" value="" >
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskEvent" class="form-label">Event</label>
                                        <input type="text" class="form-control" id="taskEvent" value="" >
                                    </div>
                                    <div class="mb-3">
                                        <label for="taskIsStarred" class="form-label">Is Starred</label>
                                        <input type="text" class="form-control" id="taskIsStarred" value="">
                                    </div>
                                    <button type="button" class="btn btn-primary" onclick="saveTaskDetails()">Save</button>

                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>